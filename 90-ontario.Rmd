# Ontario

## Research questions

```{r label = "global-options", include=FALSE}

### setting up working environment
### for details see: https://yihui.name/knitr/options/
knitr::opts_chunk$set(
        collapse = T,
        echo = F,
        message = T,
        error = T,
        warning = T,
        comment = '##',
        highlight = T,
        prompt = F,
        strip.white = T,
        tidy = T
        )

### installing and loading packages
### https://www.tidyverse.org/
if (!require("tidyverse"))
        {install.packages("tidyverse", repos = 'http://cran.wu.ac.at/')
        library(tidyverse)}

### above command installed and loaded the core tidyverse packages:
# ggplot2: data visualization
# tibble:  a modern take on data frames
# tidyr:   data tidying
# readr:   data import (csv, tsv, fwf)
# purrr:   functional R programming
# dplyr:   data (frame) manipulation
# stringr: string manipulation
# forcats: working with categorical variables

# I am going to use the `janitor` package for calculating table totals
if (!require("janitor"))
        {install.packages("janitor", repos = 'http://cran.wu.ac.at/')
        library(janitor)}

if (!require("reshape2"))
        {install.packages("reshape2", repos = 'http://cran.wu.ac.at/')
        library(reshape2)}

if (!require("readODS"))
        {install.packages("readODS", repos = 'http://cran.wu.ac.at/')
        library(readODS)}

### generate my theme
my_theme <- theme_light() +
        theme(plot.title = element_text(size = 10, face = "bold", hjust = 0.5)) +
        theme(plot.background = element_rect(color = NA, fill = NA)) +
        theme(plot.margin = margin(1, 0, 0, 0, unit = 'cm'))

### global variables

disciplines_short = c("Business", "Arts", "IT", "Law", "Earth", "Health", "History", "Language", "Literature", "Math", "Medicine", "Philosophy", "Reference", "Society", "Technology")

disciplines = c("Business & Management", "The Arts", "Computing & IT", "Law", "Earth & Environment", "Health & Development", "History", "Language & Linguistics", "Literature", "Mathematics & Science", "Medicine & Nursing", "Philosophy & Religion", "Reference", "Society & Social Sciences", "Technology & Engineering")

```

## Stand-alone distribution of H5P content types


```{r ct-stand-alone}

#read data
library(readODS)
CT_sa_type <- read_ods(
    path = "ontario_data/H5P-Content-Types-2020-10-13.ods",
    sheet = 2,
    )

ggplot(CT_sa_type, aes(x=reorder(`ContentType`, Overall), y=Overall)) + 
    geom_bar(stat="identity", width = .8) +
    coord_flip() +
    my_theme +
    xlab("Name of H5P Content Types") +
    ylab("Number of Content Types") +
    ggtitle("Distribution of H5P Stand-alone Content Types in the Ontario Repository (2020-10-13)") +
    geom_text(aes(label=Overall), size=2.8, hjust=-0.2) +
    theme(plot.margin = margin(12,12,12,12))

ggsave("ontario_plots/CT_sa_type.pdf",
    width = 8,
    height = 8
    )

#############

# calculate and prepare graph for content types by discipline

CT_sa_subject <- adorn_totals(CT_sa, where = "row", 
                                       fill = "-", na.rm = TRUE, name = "Total")      # add totals to rows
CT_sa_subject <- CT_sa_subject[nrow(CT_sa_subject) ,]                                 # get last row (= Total)
CT_sa_subject <-  melt(CT_sa_subject, variable.name="Discipline", value.name="Total") # convert to long
CT_sa_subject <- CT_sa_subject[, -1]                                                  # delete first column
CT_sa_subject$Discipline = disciplines                                                # use full names

ggplot(CT_sa_subject, aes(x=reorder(Discipline, Total), y = Total)) +
    geom_bar(stat="identity") +
    coord_flip() +
    my_theme +
    xlab("Discipline") +
    ylab("Number of Content Types in the Ontario Repository") +
    ggtitle("Usage of H5P Content Types by Discipline at the Ontario Repository") +
    geom_text(aes(label=Total), size=3, hjust=-0.2) +
    theme(plot.margin = margin(12,12,12,12))

ggsave(    
    filename = "ontario_plots/CT_sa_subject.pdf",
    width = 10,
    height = 5
    )


```



## Distribution in Question Sets

```{r ct-question-set, fig.height = 4, fig.width=7}

CT.QS <- c("Drag and Drop", "Drag Text", "Essay", "Fill in the Blanks", "Mark the Words", 
           "Multiple Choice", "True/False Question")
df.QS <- data.frame(CT.QS)

sheetNames <- list_ods_sheets("ontario_data/Questions-Set-2020-10-14.ods")
i <- length(sheetNames)
for(i in 1:i){
    df_temp <- read_ods(
                        path = "ontario_data/Questions-Set-2020-10-14.ods",
                        sheet = i)
    
### creates weird col names (df_temp[, ncol(df_temp)]…2, df_temp[, ncol(df_temp)]…3 etc.)
    df.QS <- bind_cols(df.QS, as.data.frame(df_temp[, ncol(df_temp)]))  
}
### see: https://stackoverflow.com/questions/20987295/rename-multiple-columns-by-names
names(df.QS) <-  c("CT.QS", sheetNames)

df.QS_long <- melt(df.QS, 
                      id.vars = "CT.QS",
                      variable.name = "Discipline",
                      value.name = "n")

ggplot(df.QS_long, aes(x=CT.QS, y=n, fill=Discipline)) +
    geom_bar(stat="identity") +
    my_theme +
    xlab("H5P Content Types used within Question Sets") +
    ylab("Number of Content Types used within Question Sets") +
    ggtitle("Usage of H5P Content Types within Question Sets at the Ontario Repository") +
    theme(axis.text.x = element_text(angle=50,hjust=1),
          plot.margin = margin(12,12,12,12))
    
ggsave(    
    filename = "ontario_plots/CT_QS_type.pdf",
    width = 10,
    height = 5
    )

ggplot(df.QS_long, aes(x=Discipline, y=n, fill=CT.QS)) +
    geom_bar(stat="identity") +
    my_theme +
    xlab("H5P Content Types used within Question Sets by Discipline") +
    ylab("Number of Content Types used within Question Sets") +
    ggtitle("H5P Content Types within Question Sets by Discipline at the Ontario Repository") +
    scale_fill_discrete(name = "Content Types in 
Question Sets") +
    theme(axis.text.x = element_text(angle=50,hjust=1),
          plot.margin = margin(12,12,12,12))
ggsave(    
    filename = "ontario_plots/CT_QS_subject.pdf",
    width = 10,
    height = 5
    )


```

## Distribution in Course Presentations


```{r ct-course-presentation, fig.height = 4, fig.width=7}


CT.CP <-  c("Dialog Cards", "Drag and Drop", "Drag Text", "Fill in the Blanks", "Interactive Video", 
            "Mark the Words", "Multiple Choice", "Single Choice Set", "Summary", "True/False Question")
df.CP <- data.frame(CT.CP)

sheetNames <- list_ods_sheets("ontario_data/Course-Presentation-2020-10-15.ods")
i <- length(sheetNames)
for(i in 1:i){
    df_temp <- read_ods(
                        path = "ontario_data/Course-Presentation-2020-10-15.ods",
                        sheet = i)
    
### creates weird col names (df_temp[, ncol(df_temp)]…2, df_temp[, ncol(df_temp)]…3 etc.)
    df.CP <- bind_cols(df.CP, as.data.frame(df_temp[, ncol(df_temp)]))  
}
### see: https://stackoverflow.com/questions/20987295/rename-multiple-columns-by-names
names(df.CP) <-  c("CT.CP", sheetNames)

df.CP_long <- melt(df.CP, 
                      id.vars = "CT.CP",
                      variable.name = "Discipline",
                      value.name = "n")

ggplot(df.CP_long, aes(x=CT.CP, y=n, fill=Discipline)) +
    geom_bar(stat="identity") +
    my_theme +
    xlab("H5P Content Types used within Course Presentation") +
    ylab("Number of Content Types used within Course Presentation") +
    ggtitle("Usage of H5P Content Types within Course Presentation at the Ontario Repository") +
    theme(axis.text.x = element_text(angle=50,hjust=1),
          plot.margin = margin(12,12,12,12))
    
ggsave(    
    filename = "ontario_plots/CT_CP_type.pdf",
    width = 10,
    height = 5
    )

ggplot(df.CP_long, aes(x=Discipline, y=n, fill=CT.CP)) +
    geom_bar(stat="identity") +
    my_theme +
    xlab("H5P Content Types used within Course Presentation by Discipline") +
    ylab("Number of Content Types used within Course Presentation") +
    ggtitle("H5P Content Types within Course Presentation by Discipline at the Ontario Repository") +
    scale_fill_discrete(name = "Content Types in 
Course Presentation") +
    theme(axis.text.x = element_text(angle=50,hjust=1),
          plot.margin = margin(12,12,12,12))
ggsave(    
    filename = "ontario_plots/CT_CP_subject.pdf",
    width = 10,
    height = 5
    )


```

## Distribution in Interactive Video


```{r ct-interactive-video, fig.height = 4, fig.width=7}


CT.IV <-  c("Drag and Drop", "Drag Text", "Essay", "Fill in the Blanks", "Image Hotspots", 
            "Mark the Words", "Multiple Choice", "Questionnaire", "Single Choice Set", 
            "Summary", "True/False Question")
df.IV <- data.frame(CT.IV)

sheetNames <- list_ods_sheets("ontario_data/Interactive-Video-2020-10-16.ods")
i <- length(sheetNames)
for(i in 1:i){
    df_temp <- read_ods(
                        path = "ontario_data/Interactive-Video-2020-10-16.ods",
                        sheet = i)
    
### creates weird col names (df_temp[, ncol(df_temp)]…2, df_temp[, ncol(df_temp)]…3 etc.)
    df.IV <- bind_cols(df.IV, as.data.frame(df_temp[, ncol(df_temp)]))  
}
### see: https://stackoverflow.com/questions/20987295/rename-multiple-columns-by-names
names(df.IV) <-  c("CT.IV", sheetNames)

df.IV_long <- melt(df.IV, 
                      id.vars = "CT.IV",
                      variable.name = "Discipline",
                      value.name = "n")

ggplot(df.IV_long, aes(x=CT.IV, y=n, fill=Discipline)) +
    geom_bar(stat="identity") +
    my_theme +
    xlab("H5P Content Types used within Interactive Video") +
    ylab("Number of Content Types used within Interactive Video") +
    ggtitle("Usage of H5P Content Types within Interactive Video at the Ontario Repository") +
    theme(axis.text.x = element_text(angle=50,hjust=1),
          plot.margin = margin(12,12,12,12))
    
ggsave(    
    filename = "ontario_plots/CT_IV_type.pdf",
    width = 10,
    height = 5
    )

ggplot(df.IV_long, aes(x=Discipline, y=n, fill=CT.IV)) +
    geom_bar(stat="identity") +
    my_theme +
    xlab("H5P Content Types used within Interactive Video by Discipline") +
    ylab("Number of Content Types used within Interactive Video") +
    ggtitle("H5P Content Types within Interactive Video by Discipline at the Ontario Repository") +
    scale_fill_discrete(name = "Content Types in 
Interactive Video") +
    theme(axis.text.x = element_text(angle=50,hjust=1),
          plot.margin = margin(12,12,12,12))
ggsave(    
    filename = "ontario_plots/CT_IV_subject.pdf",
    width = 10,
    height = 5
    )


```


## Summarising compound content types

```{r df_totals}
df_compounds <- list(df.QS,df.CP,df.IV)
df_sums_compounds <- list(df.QS,df.CP,df.IV)
df_sums_compounds <- adorn_totals(df_compounds, c("row","col"))
# df.QS.sums <- adorn_totals(df.QS, where = c("row","col"), fill = "-", na.rm = TRUE, name = "Total")
# df.CP.sums <- adorn_totals(df.CP, where = c("row","col"), fill = "-", na.rm = TRUE, name = "Total")
# df.IV.sums <- adorn_totals(df.IV, where = c("row","col"), fill = "-", na.rm = TRUE, name = "Total")
```

## Add values from compound content types to CT_all 


```{r total-ct-with-compounds-new}



CT_all <- CT_sa_type[, c(1,17)]   # copy CT_sa Name and Total to new df
CT_all["Compounds"] <-  0L        # add cnew olumn to CT_all

# ### create df with only rows of Name and Total (easier to check)
# QS_sums <- df.QS.sums[, c(1,17)]
# CP_sums <- df.CP.sums[, c(1,17)]
# IV_sums <- df.IV.sums[, c(1,17)]
names(df.QS)[1] <- c("ContentType")
names(df.CP)[1] <- c("ContentType")
names(df.IV)[1] <- c("ContentType")

######### start with the calculation and transfer of the values

### Dialog Cards (CP)
CT_all[11,3] <-  df.CP.sums[1,17]


### Drag and Drop (QS, CP, IV)
compound_drag_drop <- bind_rows( filter(df.QS, ContentType == "Drag and Drop"),
                        filter(df.CP, ContentType == "Drag and Drop"),
                        filter(df.IV, ContentType == "Drag and Drop"))
compound_drag_drop <- adorn_totals(compound_drag_drop, c("row","col"), 
                                   fill = "-", na.rm = TRUE, name = "Total")
CT_all[14,3] <-  compound_drag_drop[4,17]

### Drag Text (all 3)
compound_drag_text <- bind_rows(filter(df.QS, ContentType == "Drag Text"),
          filter(df.CP, ContentType == "Drag Text"),
          filter(df.IV, ContentType == "Drag Text"))
compound_drag_text <- adorn_totals(compound_drag_text, where = c("row","col"), 
                                   fill = "-", na.rm = TRUE, name = "Total")
CT_all[15,3] <-  compound_drag_text[4,17]


### Essay (IV, QS)
compound_essay <- bind_rows(filter(df.QS, ContentType == "Essay"),
          filter(df.IV, ContentType == "Essay"))
compound_essay <- adorn_totals(compound_essay, where = c("row","col"), 
                               fill = "-", na.rm = TRUE, name = "Total")
CT_all[16,3] <-  compound_essay[3,17]

### Fill in the Blanks (all 3)
compound_fill_blanks <- bind_rows(filter(df.QS, ContentType == "Fill in the Blanks"),
          filter(df.CP, ContentType == "Fill in the Blanks"),
          filter(df.IV, ContentType == "Fill in the Blanks"))
compound_fill_blanks <- adorn_totals(compound_fill_blanks, where = c("row","col"), 
                               fill = "-", na.rm = TRUE, name = "Total")
CT_all[17,3] <-  compound_fill_blanks[4,17]

### Image Hotspots (IV)
CT_all[24,3] <-  df.IV.sums[5,17]

### Interactive Video (CP)
CT_all[31,3] <-  df.CP.sums[7,17]

### Mark the Words (all 3)
compound_mark_words <- bind_rows(filter(df.QS, ContentType == "Mark the Words"),
          filter(df.CP, ContentType == "Mark the Words"),
          filter(df.IV, ContentType == "Mark the Words"))
compound_mark_words <- adorn_totals(compound_mark_words, where = c("row","col"), 
                               fill = "-", na.rm = TRUE, name = "Total")
CT_all[33,3] <-  compound_mark_words[4,17]

### Multiple Choice (all 3)
compound_multiple_choice <- bind_rows(filter(df.QS, ContentType == "Multiple Choice"),
          filter(df.CP, ContentType == "Multiple Choice"),
          filter(df.IV, ContentType == "Multiple Choice"))
compound_multiple_choice <- adorn_totals(compound_multiple_choice, where = c("row","col"), 
                               fill = "-", na.rm = TRUE, name = "Total")
CT_all[35,3] <-  compound_multiple_choice[4,17]

### Questionnaire (IV)
CT_all[37,3] <- df.IV.sums[8,17]

### Single Choice Set (CP, IV)
compound_single_choice <- bind_rows(filter(df.CP, ContentType == "Single Choice Set"),
          filter(df.IV, ContentType == "Single Choice Set"))
compound_single_choice <- adorn_totals(compound_single_choice, where = c("row","col"), 
                               fill = "-", na.rm = TRUE, name = "Total")
CT_all[39,3] <-  compound_single_choice[3,17]

### Summary (CP, IV)
compound_summary <- bind_rows(filter(df.CP, ContentType == "Summary"),
          filter(df.IV, ContentType == "Summary"))
compound_summary <- adorn_totals(compound_summary, where = c("row","col"), 
                               fill = "-", na.rm = TRUE, name = "Total")
CT_all[42,3] <-  compound_summary[3,17]

### True/False Question (all 3)
compound_true_false <- bind_rows(filter(df.QS, ContentType == "True/False Question"),
          filter(df.CP, ContentType == "True/False Question"),
          filter(df.IV, ContentType == "True/False Question"))
compound_true_false <- adorn_totals(compound_true_false, where = c("row","col"), 
                               fill = "-", na.rm = TRUE, name = "Total")
CT_all[44,3] <-  compound_true_false[4,17]


### Calculate new total
CT_all <- CT_all %>% 
    mutate(All = Total + Compounds)


```



```{r ct_all_compounds, fig.height = 7, fig.width=7}
ggplot(CT_all, aes(x=reorder(ContentType,All), y=All)) + 
    geom_bar(stat="identity") +
    coord_flip() +
    my_theme +
    xlab("Name of H5P Content Types") +
    ylab("Number of all Content Types (Stand-alone and Compound)") +
    ggtitle("Distribution of all H5P Content Types (Stand-alone and Compound)
            in the Ontario Repository (2020-10-13)") +
    geom_text(aes(label=All), size=2.8, hjust=-0.2) +
    theme(plot.margin = margin(12,12,12,12))

ggsave(    
    filename = "ontario_plots/CT_all_type.pdf",
    width = 10,
    height = 8
    )

```

## Discipline all

```{r ct-disciplines-all}
CT_sa_sums <- adorn_totals(CT_sa, where = c("row","col"), fill = "-", na.rm = TRUE, name = "Total")
CT_all_sums <- adorn_totals(CT_all, where = c("row","col"), fill = "-", na.rm = TRUE, name = "Total")
CT_subject_compounds <- bind_rows(df.QS, df.CP, df.IV)
CT_subject_all <- bind_rows(CT_sa, df.QS, df.CP, df.IV)
CT_subject_all_sums <- adorn_totals(CT_subject_all, where = c("row","col"), 
                                    fill = "-", na.rm = TRUE, name = "Total")


```


## Some preliminiary data for a blog entry

```{r blog-data}
CT_sa_sums[46,17]
CT_all_sums[46,17]
```

